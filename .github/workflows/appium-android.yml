name: Appium Android

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build-and-test:
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up JDK
        uses: actions/setup-java@v2
        with:
          java-version: 11
          distribution: 'adopt'

      - uses: actions/setup-node@v2
        with:
            node-version: '20'

      - run: |
          npm install -g appium@v2.0.1
          npm install -g appium-uiautomator2-driver
          appium -v
          appium &>/dev/null &

      - name: Set up emulator
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: 30
          arch: x86
          profile: Nexus 5
          timeout-sec: 360

      - name: Start emulator
        run: adb devices && emulator -avd emulator-5554 -no-audio -no-window &

      - name: Build and test
        run: |
            script: mvn clean test -Pandroid
  
